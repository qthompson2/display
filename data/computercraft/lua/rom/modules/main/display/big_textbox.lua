ElementTypes = require("display.element_types")
Element = require("display.element")

BigTextbox = {}
BigTextbox.DEFAULT_CHARSET = {
	["A"] = {"011100","100010","111110","100010","100010","100010","100010","000000",},
	["a"] = {"000000","000000","011100","000010","011110","100010","011110","000000",},
	["B"] = {"111100","100010","111100","100010","100010","100010","111100","000000",},
	["b"] = {"100000","100000","101100","110010","100010","100010","111100","000000",},
	["C"] = {"011100","100010","100000","100000","100000","100010","011100","000000",},
	["c"] = {"000000","000000","011100","100010","100000","100010","011100","000000",},
	["D"] = {"111100","100010","100010","100010","100010","100010","111100","000000",},
	["d"] = {"000010","000010","011010","100110","100010","100010","011110","000000",},
	["E"] = {"111110","100000","111000","100000","100000","100000","111110","000000",},
	["e"] = {"000000","000000","011100","100010","111110","100000","011110","000000",},
	["F"] = {"111110","100000","111000","100000","100000","100000","100000","000000",},
	["f"] = {"000110","001000","011110","001000","001000","001000","001000","000000",},
	["G"] = {"011110","100000","100110","100010","100010","100010","011100","000000",},
	["g"] = {"000000","000000","011110","100010","100010","011110","000010","111100",},
	["H"] = {"100010","100010","111110","100010","100010","100010","100010","000000",},
	["h"] = {"100000","100000","100000","101100","110010","100010","100010","000000",},
	["I"] = {"011100","001000","001000","001000","001000","001000","011100","000000",},
	["i"] = {"000000","000100","000000","000100","000100","000100","000100","000000",},
	["J"] = {"000010","000010","000010","000010","000010","100010","011100","000000",},
	["j"] = {"000010","000000","000010","000010","000010","100010","100010","011100",},
	["K"] = {"100010","100100","111000","100100","100010","100010","100010","000000",},
	["k"] = {"100000","100000","100100","101000","110000","101000","100100","000000",},
	["L"] = {"100000","100000","100000","100000","100000","100000","111100","000000",},
	["l"] = {"001000","001000","001000","001000","001000","001000","000100","000000",},
	["M"] = {"100010","110110","101010","101010","100010","100010","100010","000000",},
	["m"] = {"000000","000000","110100","101010","101010","100010","100010","000000",},
	["N"] = {"100010","110010","101010","100110","100010","100010","100010","000000",},
	["n"] = {"000000","000000","111100","100010","100010","100010","100010","000000",},
	["O"] = {"011100","100010","100010","100010","100010","100010","011100","000000",},
	["o"] = {"000000","000000","011100","100010","100010","100010","011100","000000",},
	["P"] = {"111100","100010","111100","100000","100000","100000","100000","000000",},
	["p"] = {"000000","000000","101100","110010","100010","111100","100000","100000",},
	["Q"] = {"011100","100010","100010","100010","101010","100100","011010","000000",},
	["q"] = {"000000","000000","011010","100110","100010","011110","000010","000010",},
	["R"] = {"111100","100010","111100","100010","100010","100010","100010","000000",},
	["r"] = {"000000","000000","101100","110010","100000","100000","100000","000000",},
	["S"] = {"011110","100000","011100","000010","000010","100010","011100","000000",},
	["s"] = {"000000","000000","011110","100000","011100","000010","111100","000000",},
	["T"] = {"111110","001000","001000","001000","001000","001000","001000","000000",},
	["t"] = {"001000","001000","111110","001000","001000","001000","000100","000000",},
	["U"] = {"100010","100010","100010","100010","100010","100010","011100","000000",},
	["u"] = {"000000","000000","100010","100010","100010","100010","011110","000000",},
	["V"] = {"100010","100010","100010","100010","010100","010100","001000","000000",},
	["v"] = {"000000","000000","100010","100010","100010","010100","001000","000000",},
	["W"] = {"100010","100010","100010","100010","101010","110110","100010","000000",},
	["w"] = {"000000","000000","100010","100010","101010","101010","011110","000000",},
	["X"] = {"100010","010100","001000","010100","100010","100010","100010","000000",},
	["x"] = {"000000","000000","100010","010100","001000","010100","100010","000000",},
	["Y"] = {"100010","010100","001000","001000","001000","001000","001000","000000",},
	["y"] = {"000000","000000","100010","100010","100010","011110","000010","111100",},
	["Z"] = {"111110","000010","000100","001000","010000","100000","111110","000000",},
	["z"] = {"000000","000000","111110","000100","001000","010000","111110","000000",},
	["0"] = {"011100","100010","100110","101010","110010","100010","011100","000000",},
	["1"] = {"001000","011000","001000","001000","001000","001000","111110","000000",},
	["2"] = {"011100","100010","000010","001100","010000","100010","111110","000000",},
	["3"] = {"011100","100010","000010","001100","000010","100010","011100","000000",},
	["4"] = {"000110","001010","010010","100010","111110","000010","000010","000000",},
	["5"] = {"111110","100000","111100","000010","000010","100010","011100","000000",},
	["6"] = {"001100","010000","100000","111100","100010","100010","011100","000000",},
	["7"] = {"111110","100010","000010","000100","001000","001000","001000","000000",},
	["8"] = {"011100","100010","100010","011100","100010","100010","011100","000000",},
	["9"] = {"011100","100010","100010","011110","000010","000100","011000","000000",},
	[" "] = {"000000","000000","000000","000000","000000","000000","000000","000000",},
	["!"] = {"001000","001000","001000","001000","001000","000000","001000","000000",},
	["@"] = {"011110","100001","101101","101101","101111","100000","011110","000000",},
	["#"] = {"010100","010100","111110","010100","111110","010100","010100","000000",},
	["$"] = {"001000","011110","100000","011100","000010","111100","001000","000000",},
	["%"] = {"100010","100100","000100","001000","010000","010010","100010","000000",},
	["^"] = {"001000","010100","100010","000000","000000","000000","000000","000000",},
	["&"] = {"001000","010100","001000","011010","101100","100100","011010","000000",},
	["*"] = {"000000","000000","100100","011000","100100","000000","000000","000000",},
	[","] = {"000000","000000","000000","000000","000000","010000","010000","010000",},
	["."] = {"000000","000000","000000","000000","000000","010000","010000","000000",},
	["/"] = {"000001","000010","000010","000100","001000","001000","010000","000000",},
	["\\"] = {"100000","010000","010000","001000","000100","000100","000010","000000",},
	["?"] = {"011100","100010","000010","000100","001000","000000","001000","000000",},
	["|"] = {"0100000","010000","010000","010000","010000","010000","010000","000000",},
	[";"] = {"000000","010000","010000","000000","000000","010000","010000","010000",},
	[":"] = {"000000","010000","010000","000000","000000","010000","010000","000000",},
	["'"] = {"001000","001000","010000","000000","000000","000000","000000","000000",},
	["\""] = {"001010","001010","010100","000000","000000","000000","000000","000000",},
	["<"] = {"000010","000100","001000","010000","001000","000100","000010","000000",},
	[">"] = {"010000","001000","000100","000010","000100","001000","010000","000000",},
	["("] = {"000110","001000","010000","010000","010000","001000","000110","000000",},
	[")"] = {"011000","000100","000010","000010","000010","000100","011000","000000",},
	["["] = {"011110","010000","010000","010000","010000","010000","011110","000000",},
	["]"] = {"011110","000010","000010","000010","000010","000010","011110","000000",},
	["{"] = {"000110","001000","001000","010000","001000","001000","000110","000000",},
	["}"] = {"011000","000100","000100","000010","000100","000100","011000","000000",},
	["~"] = {"011001","100110","000000","000000","000000","000000","000000","000000",},
	["-"] = {"000000","000000","000000","111110","000000","000000","000000","000000",},
	["="] = {"000000","000000","111110","000000","000000","111110","000000","000000",},
	["+"] = {"000000","001000","001000","111110","001000","001000","000000","000000",},
	["`"] = {"010000","010000","001000","000000","000000","000000","000000","000000",},
	unknown = {"111110","100010","100010","100010","100010","100010","111110","000000",}
}

BigTextbox.COLOURS = {
	[colours.white] = "0",
	[colours.orange] = "1",
	[colours.magenta] = "2",
	[colours.lightBlue] = "3",
	[colours.yellow] = "4",
	[colours.lime] = "5",
	[colours.pink] = "6",
	[colours.grey] = "7",
	[colours.lightGrey] = "8",
	[colours.cyan] = "9",
	[colours.purple] = "a",
	[colours.blue] = "b",
	[colours.brown] = "c",
	[colours.green] = "d",
	[colours.red] = "e",
	[colours.black] = "f",
}

setmetatable(BigTextbox, {__index = Element})

function BigTextbox:new(content, x, y, palette)
	local obj = Element:new(x, y, palette)
	obj.type = ElementTypes.BIGTEXTBOX
	obj.content = {
		standard = {
			[1] = "",
			[2] = "",
			[3] = "",
			[4] = "",
			[5] = "",
			[6] = "",
			[7] = "",
			[8] = "",
		},
		selected = {
			[1] = "",
			[2] = "",
			[3] = "",
			[4] = "",
			[5] = "",
			[6] = "",
			[7] = "",
			[8] = "",
		}
	}

	for i = 1, #content do
		local char = content:sub(i, i)
		if BigTextbox.DEFAULT_CHARSET[char] then
			for j = 1, 8 do
				for k = 1, #BigTextbox.DEFAULT_CHARSET[char][j] do
					if BigTextbox.DEFAULT_CHARSET[char][j]:sub(k, k) == "1" then
						obj.content.standard[j] = obj.content.standard[j] .. BigTextbox.COLOURS[palette.standard.fg]
						obj.content.selected[j] = obj.content.selected[j] .. BigTextbox.COLOURS[palette.selected.fg]
					else
						obj.content.standard[j] = obj.content.standard[j] .. BigTextbox.COLOURS[palette.standard.bg]
						obj.content.selected[j] = obj.content.selected[j] .. BigTextbox.COLOURS[palette.selected.bg]
					end
				end
			end
		else
			for j = 1, #BigTextbox.DEFAULT_CHARSET.unknown do
				for k = 1, #BigTextbox.DEFAULT_CHARSET.unknown[j] do
					if BigTextbox.DEFAULT_CHARSET.unknown[j]:sub(k, k) == "1" then
						obj.content.standard[j] = obj.content.standard[j] .. BigTextbox.COLOURS[palette.standard.fg]
						obj.content.selected[j] = obj.content.selected[j] .. BigTextbox.COLOURS[palette.selected.fg]
					else
						obj.content.standard[j] = obj.content.standard[j] .. BigTextbox.COLOURS[palette.standard.bg]
						obj.content.selected[j] = obj.content.selected[j] .. BigTextbox.COLOURS[palette.selected.bg]
					end
				end
			end
		end
	end

	setmetatable(obj, self)
	self.__index = self

	return obj
end

function BigTextbox:draw()
	for i = 1, #self.content.standard do
		local blank_line = (" "):rep(#self.content.standard[i])
		term.setCursorPos(self.x, self.y + i - 1)
		if self.selected then
			term.blit(blank_line, blank_line, self.content.selected[i])
		else
			term.blit(blank_line, blank_line, self.content.standard[i])
		end
	end
end

function BigTextbox:len()
	return #self.content.standard[1]
end

function BigTextbox:findPos(x, y)
	if x >= self.x and x <= self.x + #self.content.standard[1] - 1 and y >= self.y and y <= self.y + #self.content.standard - 1 then
		return true
	else
		return false
	end
end

return BigTextbox